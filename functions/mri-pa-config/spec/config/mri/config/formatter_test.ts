import * as mFormatter from "../../../src/mri/config/formatter";
import { MockHdb } from "../../testutils/mockHdb";
import * as qeFormatter from "../../../src/mri/config/qe-formatter";
import { CONFIG_FORMATTER_SETTINGS } from "../../../src/mri/config/config";

let fakeConnection;
let formatter;

let fp2Config = {
    /* tslint:disable: max-line-length */
    // tslint:disable-next-line:object-literal-key-quotes
    "filtercards": [{ "source": "patient", "visible": true, "order": 1, "initial": true, "attributes": [{ "source": "patient.attributes.pid", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 1 }, "patientlist": { "initial": false, "visible": true, "linkColumn": true } }, { "source": "patient.attributes.smoker", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.pcount", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": true, "filtercard": { "initial": false, "visible": false, "order": 3 }, "patientlist": { "initial": false, "visible": false, "linkColumn": false } }, { "source": "patient.attributes.nationality", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.cohort", "ordered": false, "cached": false, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.lastName", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 6 }, "patientlist": { "initial": true, "visible": true, "linkColumn": true, "order": 1 } }, { "source": "patient.attributes.street", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 7 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.city", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 8 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.zipcode", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 9 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.region", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 10 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.country", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 11 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.gender", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 13 }, "patientlist": { "initial": true, "visible": true, "linkColumn": false, "order": 4 } }, { "source": "patient.attributes.firstName", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 14 }, "patientlist": { "initial": true, "visible": true, "linkColumn": true, "order": 2 } }, { "source": "patient.attributes.monthOfBirth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 15 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.yearOfBirth", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 16 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.dateOfBirth", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 17 }, "patientlist": { "initial": true, "visible": true, "linkColumn": false, "order": 3 } }, { "source": "patient.attributes.dateOfDeath", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 18 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.maritalStatus", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 19 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.title", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 20 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.biomarker", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 21 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.attributes.packYearsSmoked", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 22 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false }, "defaultBinSize": 20 }, { "source": "patient.attributes.smokingOnset", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 23 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false }, "defaultBinSize": 5 }, { "source": "patient.attributes.smokingOnsetAge", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 24 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false }, "defaultBinSize": 5 }, { "source": "patient.attributes.smokingStopped", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 25 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false }, "defaultBinSize": 5 }] }, { "source": "patient.conditions.acme.interactions.priDiag", "visible": true, "order": 2, "initial": true, "attributes": [{ "source": "patient.conditions.acme.interactions.priDiag.attributes.icd_10", "ordered": false, "cached": true, "useRefText": true, "useRefValue": true, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 1 }, "patientlist": { "initial": true, "visible": true, "linkColumn": false, "order": 6 } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.icd_9", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false, "order": 0 } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.age", "ordered": true, "cached": true, "defaultBinSize": 10, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": true, "visible": true, "order": 3 }, "patientlist": { "initial": true, "visible": true, "linkColumn": false, "order": 5 } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.nsclc", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.freetextDiag", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": false, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 7 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 8 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 9 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.histology", "ordered": false, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 10 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.tcgaCode", "ordered": false, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 11 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.priDiag.attributes.tcgaCancer", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 12 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }] }, { "source": "patient.conditions.acme.interactions.tnm", "visible": true, "order": 3, "initial": false, "attributes": [{ "source": "patient.conditions.acme.interactions.tnm.attributes.tnmM", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 1 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.tnm.attributes.tnmN", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.tnm.attributes.tnmT", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.tnm.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.tnm.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.tnm.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.tnm.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 7 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }] }, { "source": "patient.conditions.acme.interactions.radio", "visible": true, "order": 4, "initial": false, "attributes": [{ "source": "patient.conditions.acme.interactions.radio.attributes.radio_dosage", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 1 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.radio.attributes.radio_ops", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.radio.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.radio.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.radio.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.radio.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }], "modelName": "Radiotherapy" }, { "source": "patient.conditions.acme.interactions.chemo", "visible": true, "order": 5, "initial": false, "attributes": [{ "source": "patient.conditions.acme.interactions.chemo.attributes.interactionCount", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": true, "filtercard": { "initial": false, "visible": false, "order": 1 }, "patientlist": { "initial": false, "visible": true } }, { "source": "patient.conditions.acme.interactions.chemo.attributes.chemo_ops", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.chemo.attributes.chemo_prot", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.chemo.attributes.interactionsPerPatient", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": true, "filtercard": { "initial": false, "visible": false, "order": 4 }, "patientlist": { "initial": false, "visible": true } }, { "source": "patient.conditions.acme.interactions.chemo.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.chemo.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.chemo.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 7 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.chemo.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 8 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false }, "modelName": "End Date" }] }, { "source": "patient.conditions.acme.interactions.surgery", "visible": true, "order": 6, "initial": false, "attributes": [{ "source": "patient.conditions.acme.interactions.surgery.attributes.exist", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 1 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.surgery.attributes.surgery_ops", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.surgery.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.surgery.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.surgery.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.surgery.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }], "modelName": "Surgery" }, { "source": "patient.interactions.ga_sample", "visible": true, "order": 7, "initial": false, "attributes": [{ "source": "patient.interactions.ga_sample.attributes.sample_id", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 1 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_sample.attributes.reference_id", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_sample.attributes.sample_class", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_sample.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": false, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_sample.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": false, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_sample.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_sample.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 7 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }], "modelName": "Tissue Sample" }, { "source": "patient.interactions.ga_mutation", "visible": true, "order": 8, "initial": false, "attributes": [{ "source": "patient.interactions.ga_mutation.attributes.location", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": false, "measure": false, "filtercard": { "initial": false, "visible": false, "order": 1 }, "patientlist": { "initial": false, "visible": false, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.gene", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.region", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.variant_type", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.seq_alteration", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.aa_ref", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.aa_alt", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 7 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 8 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 9 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 10 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.ga_mutation.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 11 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }] }, { "source": "patient.interactions.vStatus", "visible": true, "order": 9, "initial": false, "attributes": [{ "source": "patient.interactions.vStatus.attributes.age", "ordered": true, "cached": true, "defaultBinSize": 10, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": true, "visible": true, "order": 1 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.vStatus.attributes.status", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.vStatus.attributes.year", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": true, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.vStatus.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.vStatus.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.vStatus.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.interactions.vStatus.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 7 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }] }, { "source": "patient.conditions.acme.interactions.biobank", "visible": true, "order": 10, "initial": false, "attributes": [{ "source": "patient.conditions.acme.interactions.biobank.attributes.status", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 1 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.biobank.attributes.tType", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": true, "visible": true, "order": 2 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.biobank.attributes.calYear", "ordered": true, "cached": true, "defaultBinSize": 5, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 3 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.biobank.attributes.calMonth", "ordered": true, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": true, "filtercard": { "initial": false, "visible": true, "order": 4 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.biobank.attributes.start", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 5 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }, { "source": "patient.conditions.acme.interactions.biobank.attributes.end", "ordered": false, "cached": true, "useRefText": false, "useRefValue": false, "category": true, "measure": false, "filtercard": { "initial": false, "visible": true, "order": 6 }, "patientlist": { "initial": false, "visible": true, "linkColumn": false } }] }], "chartOptions": { "initialAttributes": { "measures": ["patient.attributes.pcount"], "categories": ["patient.conditions.acme.interactions.priDiag.attributes.icd_10"] }, "initialChart": "stacked", "stacked": { "visible": true, "downloadEnabled": true, "collectionEnabled": true, "beginVisible": true }, "boxplot": { "visible": true, "downloadEnabled": true, "collectionEnabled": true, "beginVisible": true }, "km": { "visible": true, "downloadEnabled": true, "collectionEnabled": true, "beginVisible": true, "confidenceInterval": 1.95996398454 }, "list": { "visible": true, "downloadEnabled": true, "collectionEnabled": true, "beginVisible": true, "pageSize": 20 }, "vb": { "visible": true, "referenceName": "GRCh37" }, "minCohortSize": 1 }, "configInformations": { "note": "This is a demo configuration for Patient Analytics, and should be replaced with a proper configuration." },
};

let cdwConfig = {
    // tslint:disable-next-line:object-literal-key-quotes
    "patient": { "conditions": { "acme": { "interactions": { "priDiag": { "name": "Primary Tumor Diagnosis", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'ACME_M03'", "defaultFilterKey": "ACME_M03", "order": 4, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "icd_10": { "name": "ICD-10-CM Code", "type": "text", "expression": "LEFT(@CODE.\"Value\",3)", "defaultFilter": "@CODE.\"AttributeValue\" = 'ICD_10'", "referenceFilter": "@REF.\"VocabularyID\" = 'ots.ICD.ICD10GM' AND @REF.\"Language\"='de' AND (LENGTH(@REF.\"Code\")=3 OR (LENGTH(@REF.\"Code\")=5 AND @REF.\"Code\" LIKE '%.-'))", "referenceExpression": "LEFT(@REF.\"Code\",3)", "order": 1 }, "icd_9": { "name": "ICD-9-CM Code", "type": "text", "expression": "LEFT(@CODE.\"Value\",3)", "defaultFilter": "@CODE.\"AttributeValue\" = 'ICD_9'", "order": 2 }, "age": { "name": "Age at Diagnosis", "type": "num", "expression": "FLOOR(DAYS_BETWEEN(@PATIENT.\"BirthDate\",@INTERACTION.\"PeriodEnd\") / 365)", "defaultFilter": "@PATIENT.\"BirthDate\" <= @INTERACTION.\"PeriodEnd\"", "order": 3 }, "nsclc": { "name": "Lung Cancer Subtype", "type": "text", "expression": "@CODE.\"Value\"", "eavExpressionKey": "LC_TYPE", "defaultFilter": "@CODE.\"AttributeValue\" = 'LC_TYPE'", "order": 4 }, "freetextDiag": { "name": "Diagnosis Free Text", "type": "freetext", "expression": "@TEXT.\"Value\"", "defaultFilter": "@TEXT.\"Attribute\" = 'INTERACTIONS_FREETEXT'", "order": 5, "fuzziness": 0.8 }, "histology": { "name": "Histology", "type": "text", "expression": "@CODE.\"Value\"", "eavExpressionKey": "Histology", "defaultFilter": "@CODE.\"AttributeValue\" = 'Histology'", "order": 6 }, "tcgaCode": { "name": "Cancer Abbreviation", "type": "text", "expression": "@CODE.\"Value\"", "eavExpressionKey": "TCGA_CODE", "defaultFilter": "@CODE.\"AttributeValue\" = 'TCGA_CODE'", "order": 7 }, "tcgaCancer": { "name": "Cancer Type", "type": "text", "expression": "@CODE.\"Value\"", "eavExpressionKey": "TCGA_CANCER", "defaultFilter": "@CODE.\"AttributeValue\" = 'TCGA_CANCER'", "order": 8 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "biobank": { "name": "Biobank", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'BIOBANK'", "defaultFilterKey": "BIOBANK", "order": 5, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "status": { "name": "Sample Status", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'BIOBANK_STATUS'", "order": 1 }, "tType": { "name": "Tissue / Liquid Type", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'BIOBANK_TYPE'", "order": 2 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "chemo": { "name": "Chemotherapy", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'ACME_M07_CHEMO'", "defaultFilterKey": "ACME_M07_CHEMO", "order": 6, "parentInteraction": ["patient.conditions.acme.interactions.priDiag"], "parentInteractionLabel": "Parent", "attributes": { "interactionCount": { "name": "Interaction Count", "type": "num", "measureExpression": "COUNT(DISTINCT(@INTERACTION.\"InteractionID\"))", "order": 1, "defaultFilter": "" }, "chemo_ops": { "name": "OPS Code", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'CHEMO_OPS'", "order": 2 }, "chemo_prot": { "name": "Protocol", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'CHEMO_PROT'", "order": 3 }, "interactionsPerPatient": { "name": "Interactions per Patient", "type": "num", "measureExpression": "COUNT(DISTINCT(@INTERACTION.\"InteractionID\")) / COUNT(DISTINCT(@PATIENT.\"PatientID\"))", "order": 4, "defaultFilter": "" }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "radio": { "name": "Radiotherapy", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'ACME_M07_RADIO'", "defaultFilterKey": "ACME_M07_RADIO", "order": 7, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "radio_dosage": { "name": "Radio Dosage (Gy)", "type": "num", "expression": "@MEASURE.\"Value\"", "defaultFilter": "@MEASURE.\"AttributeValue\" = 'DOSAGE' AND @MEASURE.\"Unit\" = 'Gy'", "order": 1 }, "radio_ops": { "name": "OPS Code", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'RADIO_OPS'", "order": 2 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "surgery": { "name": "Surgery", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'ACME_M07_SURGERY'", "defaultFilterKey": "ACME_M07_SURGERY", "order": 8, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "exist": { "name": "Exist", "type": "text", "expression": "CASE WHEN @INTERACTION.\"InteractionID\" IS NULL THEN NULL ELSE 'YES' END", "order": 1, "defaultFilter": "" }, "surgery_ops": { "name": "OPS Code", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'SURGERY_OPS'", "order": 2 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "tnm": { "name": "TNM Classification", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'ACME_M03TS'", "defaultFilterKey": "ACME_M03TS", "order": 9, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "tnmM": { "name": "M-Component", "type": "text", "expression": "'M' || @CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'TNM_M'", "order": 1 }, "tnmN": { "name": "N-Component", "type": "text", "expression": "'N' || @CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'TNM_N'", "order": 2 }, "tnmT": { "name": "T-Component", "type": "text", "expression": "'T' || @CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'TNM_T'", "order": 3 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } } }, "name": "acme" } }, "interactions": { "vStatus": { "name": "Vital Status", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'ACME_M16'", "defaultFilterKey": "ACME_M16", "order": 3, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "age": { "name": "Age at Last Contact", "type": "num", "expression": "FLOOR(DAYS_BETWEEN(@PATIENT.\"BirthDate\",@INTERACTION.\"PeriodEnd\") / 365)", "defaultFilter": "@PATIENT.\"BirthDate\" <= @INTERACTION.\"PeriodEnd\"", "order": 0 }, "status": { "name": "Vital Status", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'VITALSTATUS'", "order": 1 }, "year": { "name": "Year of Last Contact", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 2, "defaultFilter": "" }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "ga_sample": { "name": "Genome Sequencing", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'Genomic'", "defaultFilterKey": "Genomic", "order": 1, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "sample_id": { "name": "Sample Id", "type": "text", "expression": "@CODE.\"Value\"", "eavExpressionKey": "SampleIndex", "defaultFilter": "@CODE.\"AttributeValue\" = 'SampleIndex'", "order": 1, "annotations": ["genomics_sample_id"] }, "reference_id": { "name": "Genome Reference", "type": "text", "expression": "@CODE.\"Value\"", "eavExpressionKey": "ReferenceGenome", "defaultFilter": "@CODE.\"AttributeValue\" = 'ReferenceGenome'", "order": 2 }, "sample_class": { "name": "Sample Class", "type": "text", "expression": "@CODE.\"Value\"", "eavExpressionKey": "SampleClass", "defaultFilter": "@CODE.\"AttributeValue\" = 'SampleClass'", "order": 3 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "ga_mutation": { "name": "Genetic Variant", "defaultFilter": "1=1", "order": 2, "from": { "@INTERACTION": "\"CDMDEFAULT\".\"legacy.genomics.db.models::MRI.VariantInteractionsDWViews\"" }, "parentInteraction": [], "parentInteractionLabel": "Parent", "attributes": { "location": { "name": "Location", "type": "num", "expression": "@INTERACTION.POSITION_START", "relationExpressionKey": "POSITION_START", "order": 1, "annotations": ["genomics_variant_location"], "defaultFilter": "" }, "gene": { "name": "Gene", "type": "text", "expression": "@INTERACTION.GENE_NAME", "relationExpressionKey": "GENE_NAME", "order": 2, "defaultFilter": "" }, "region": { "name": "Region", "type": "text", "expression": "@INTERACTION.REGION", "relationExpressionKey": "REGION", "order": 3, "defaultFilter": "" }, "variant_type": { "name": "Variant Type", "type": "text", "expression": "@INTERACTION.VARIANT_TYPE", "relationExpressionKey": "VARIANT_TYPE", "order": 4, "defaultFilter": "" }, "seq_alteration": { "name": "Sequence Alteration", "type": "text", "expression": "@INTERACTION.SEQUENCE_ALTERATION", "relationExpressionKey": "SEQUENCE_ALTERATION", "order": 5, "defaultFilter": "" }, "aa_ref": { "name": "Amino Acid Reference", "type": "text", "expression": "@INTERACTION.AA_REF", "relationExpressionKey": "AA_REF", "order": 6, "defaultFilter": "" }, "aa_alt": { "name": "Amino Acid", "type": "text", "expression": "@INTERACTION.AA_ALT", "relationExpressionKey": "AA_ALT", "order": 7, "defaultFilter": "" }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "Medication_Administered": { "name": "Medication, Administered", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'Medication, Administered'", "order": 1, "parentInteraction": [], "parentInteractionLabel": "parent", "attributes": { "Dosage": { "name": "Dosage", "type": "num", "expression": "@MEASURE.\"Value\"", "defaultFilter": "@MEASURE.\"AttributeValue\" = 'Dosage'", "order": 0 }, "Drug_ID": { "name": "Drug ID", "type": "text", "expression": "@CODE.\"Value\"", "defaultFilter": "@CODE.\"AttributeValue\" = 'Drug ID'", "order": 1 }, "Unit": { "name": "Unit", "type": "text", "expression": "@MEASURE.\"Unit\"", "defaultFilter": "@MEASURE.\"AttributeValue\" = 'Dosage'", "order": 2 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } }, "Weight_Measurement": { "name": "Weight Measurement", "defaultFilter": "@INTERACTION.\"InteractionTypeValue\" = 'Weight Measurement'", "order": 0, "parentInteraction": [], "parentInteractionLabel": "parent", "attributes": { "Weight": { "name": "Weight", "type": "num", "expression": "ROUND(@MEASURE.\"Value\",1)", "defaultFilter": "@MEASURE.\"AttributeValue\" = 'Weight'", "order": 0 }, "calYear": { "name": "Start Year", "type": "num", "expression": "YEAR(@INTERACTION.\"PeriodStart\")", "order": 26, "isDefault": true }, "calMonth": { "name": "Start Month", "type": "num", "expression": "MONTH(@INTERACTION.\"PeriodStart\")", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.MONTHS' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 27, "isDefault": true }, "start": { "name": "Start Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodStart\")", "order": 28, "isDefault": true }, "end": { "name": "End Date", "type": "time", "expression": "TO_DATE(@INTERACTION.\"PeriodEnd\")", "order": 29, "isDefault": true }, "startdatetime": { "name": "Start Date/Time", "type": "datetime", "expression": "@INTERACTION.\"PeriodStart\"", "order": 30, "isDefault": true } } } }, "attributes": { "pid": { "name": "Patient ID", "type": "text", "expression": "@PATIENT.\"PatientID\"", "order": 1 }, "smoker": { "name": [{ "lang": "", "value": "Smoker" }, { "lang": "en", "value": "Smoker" }, { "lang": "de", "value": "Raucher" }, { "lang": "fr", "value": "Fumeur" }], "type": "text", "expression": "@OBS.\"ObsCharValue\"", "defaultFilter": "@OBS.\"ObsType\" = 'SMOKER'", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.YES-NO' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 2 }, "pcount": { "name": "Patient Count", "type": "num", "measureExpression": "COUNT(DISTINCT(@PATIENT.\"PatientID\"))", "order": 3 }, "nationality": { "name": "Nationality", "type": "text", "expression": "@PATIENT.\"NationalityValue\"", "order": 4 }, "cohort": { "name": "Cohort", "type": "text", "expression": "@OBS.\"ObsCharValue\"", "defaultFilter": "@OBS.\"ObsCharValue\"=@OBS.\"ObsCharValue\"", "order": 5, "from": { "@OBS": "\"CDMDEFAULT\".\"legacy.cdw.db.models::DWViews.CollectionsAsObservation\"" } }, "firstName": { "name": "First Name", "type": "text", "expression": "@PATIENT.\"GivenName\"", "order": 6 }, "lastName": { "name": "Last Name", "type": "text", "expression": "@PATIENT.\"FamilyName\"", "order": 7 }, "street": { "name": "Street", "type": "text", "expression": "@PATIENT.\"StreetName\"", "order": 8 }, "city": { "name": "City", "type": "text", "expression": "@PATIENT.\"City\"", "order": 9 }, "zipcode": { "name": "ZIP Code", "type": "text", "expression": "@PATIENT.\"PostalCode\"", "order": 10 }, "region": { "name": "Region", "type": "text", "expression": "@PATIENT.\"State\"", "order": 11 }, "country": { "name": "Country", "type": "text", "expression": "@PATIENT.\"CountryValue\"", "order": 12 }, "gender": { "name": "Gender", "type": "text", "expression": "@PATIENT.\"GenderValue\"", "referenceFilter": "@REF.\"VocabularyID\"='mri.CAT.GENDER' AND @REF.\"Language\"='en'", "referenceExpression": "@REF.\"Code\"", "order": 13 }, "monthOfBirth": { "name": "Month of Birth", "type": "num", "expression": "MONTH(@PATIENT.\"BirthDate\")", "order": 14 }, "yearOfBirth": { "name": "Year of Birth", "type": "num", "expression": "YEAR(@PATIENT.\"BirthDate\")", "order": 15 }, "dateOfBirth": { "name": "Date of Birth", "type": "time", "expression": "@PATIENT.\"BirthDate\"", "order": 16 }, "dateOfDeath": { "name": "Date of Death", "type": "time", "expression": "@PATIENT.\"DeceasedDate\"", "order": 17 }, "maritalStatus": { "name": "Marital Status", "type": "text", "expression": "@PATIENT.\"MaritalStatusValue\"", "order": 18 }, "title": { "name": "Title", "type": "text", "expression": "@PATIENT.\"TitleValue\"", "order": 19 }, "biomarker": { "name": "Biomarker Type", "type": "text", "expression": "@OBS.\"ObsCharValue\"", "defaultFilter": "@OBS.\"ObsType\" = 'BIOMARKER'", "order": 20 }, "packYearsSmoked": { "name": "Pack-Years Smoked", "type": "num", "expression": "@OBS.\"ObsNumValue\"", "defaultFilter": "@OBS.\"ObsType\" = 'PACK_YEARS_SMOKED'", "order": 21 }, "smokingOnset": { "name": "Smoking Onset Year", "type": "num", "expression": "@OBS.\"ObsNumValue\"", "defaultFilter": "@OBS.\"ObsType\" = 'SMOKING_ONSET'", "order": 22 }, "smokingOnsetAge": { "name": "Smoking Onset Age", "type": "num", "expression": "@OBS.\"ObsNumValue\"", "defaultFilter": "@OBS.\"ObsType\" = 'SMOKING_ONSET_AGE'", "order": 23 }, "smokingStopped": { "name": "Smoking Stopped Year", "type": "num", "expression": "@OBS.\"ObsNumValue\"", "defaultFilter": "@OBS.\"ObsType\" = 'SMOKING_STOPPED'", "order": 24 }, "dwSource": { "name": "DW Source", "type": "text", "expression": "@PATIENT.\"Source\"", "order": 25 } } }, "mapping": {}, "censor": {},
};

const globalSetting = {
    Id: "GlobalSettings",
    Version: "A",
    Status: "A",
    Name: "GLOBAL",
    Type: "HC/HPH/GLOBAL",
    Data: `{"tableMapping":{"@INTERACTION":"CDMDEFAULT.\"legacy.cdw.db.models::DWViews.Interactions\"", "@OBS":"CDMDEFAULT.\"legacy.cdw.db.models::DWViews.Observations\"", "@CODE":"CDMDEFAULT.\"legacy.cdw.db.models::DWViewsEAV.Interaction_Details\"", "@MEASURE":"CDMDEFAULT.\"legacy.cdw.db.models::DWViewsEAV.Interaction_Measures\"", "@REF":"CDMDEFAULT.\"legacy.ots.services::Views.Terms\"", "@PATIENT":"CDMDEFAULT.\"legacy.cdw.db.models::DWViews.Patient\"", "@TEXT":"CDMDEFAULT.\"legacy.cdw.db.models::DWViewsEAV.Interaction_Text\""},"guardedTableMapping":{ "@PATIENT":"\"CDMDEFAULT\".\"legacy.cdw.db.models::DWViews.V_GuardedPatient\"" },"language":["en", "de", "fr"], "settings":{ "fuzziness":0.7, "maxResultSize":5000, "sqlReturnOn":true, "errorDetailsReturnOn":true, "errorStackTraceReturnOn":true, "hhpSchemaName":"CDMDEFAULT", "refSchemaName":"CDMDEFAULT", "kaplanMeierTable":"CDMDEFAULT.\"pa.db::MRIEntities.KaplanMeierInput\"", "bookmarks_schema":"CDMDEFAULT", "medexSchemaName":"CDMDEFAULT", "vbEnabled":true, "patientDataAccessLogging":false },"columnMap":{ "CONDITION_ID":"\"ConditionID\"", "INTERACTION_ID":"\"InteractionID\"", "PARENT_INTERACT_ID":"PARENT_INTERACT_ID", "PATIENT_ID":"\"PatientID\"" }}`,
};
/* tslint:enable: max-line-length */
describe("Check the Admin Formatter functionality", () => {

    beforeEach(() => {
        fakeConnection = MockHdb.getConnection([globalSetting]);
        formatter = new mFormatter.Formatter({});
        spyOn(formatter, "_loadDefaultValues").and.callFake(() => {
            return {
                filtercards: {
                    visible: true,
                    initial: false,
                },
                attributes: {
                    ordered: false,
                    cached: true,
                    useRefText: false,
                    useRefValue: false,
                    category: true,
                    measure: true,
                    filtercard: {
                        initial: false,
                        visible: true,
                    },
                    patientlist: {
                        initial: false,
                        visible: true,
                        linkColumn: false,
                    },
                },
                chartOptions: {
                    initialAttributes: {
                        measures: [],
                        categories: [],
                    },
                    initialChart: "stacked",
                    stacked: {
                        visible: true,
                        downloadEnabled: true,
                        collectionEnabled: true,
                        beginVisible: true,
                        fillMissingValuesEnabled: true,
                    },
                    boxplot: {
                        visible: true,
                        downloadEnabled: true,
                        collectionEnabled: true,
                        beginVisible: true,
                        fillMissingValuesEnabled: true,
                    },
                    km: {
                        visible: true,
                        downloadEnabled: true,
                        collectionEnabled: true,
                        beginVisible: true,
                        confidenceInterval: 1.959963984540,
                        filters: [
                        ],
                        selectedInteractions: [
                        ],
                    },
                    list: {
                        visible: true,
                        downloadEnabled: true,
                        collectionEnabled: true,
                        beginVisible: true,
                        pageSize: 20,
                    },
                    vb: {
                        visible: true,
                        referenceName: "GRCh37",
                    },
                    custom: {
                        visible: false,
                        customCharts: [],
                    },
                    sac: {
                        visible: false,
                        sacCharts: [],
                    },
                    shared: {
                        enabled: false,
                        systemName: "MRI",
                    },
                    minCohortSize: 10,
                },
                panelOptions: {
                    afp: {
                        visible: true,
                    },
                    advancedTimeFiltering: {
                        useNextInteraction: false,
                    },
                },
                configInformations: {
                    note: "",
                },
            };
        });
    });

    it("returns the annotations of the CDW", () => {
        let formattedConfig = formatter.formatAdminConfig({
            mriConfig: fp2Config,
            dmConfig: JSON.parse(JSON.stringify(cdwConfig)),
            lang: "en",
        });
        let count = 0;

        for (let i = 0; i < formattedConfig.filtercards.length; i++) {
            if (formattedConfig.filtercards[i].attributes) {
                for (let ii = 0; ii < formattedConfig.filtercards[i].attributes.length; ii++) {
                    if (formattedConfig.filtercards[i].attributes[ii].annotations) {
                        count++;
                    }
                }
            }
        }

        expect(count > 0);
    });

    it("it adds the missing panel options components to older (e.g FP2) config", () => {
        let formattedConfig = formatter.formatAdminConfig({
            mriConfig: fp2Config,
            dmConfig: JSON.parse(JSON.stringify(cdwConfig)),
            lang: "en",
        });
        expect(formattedConfig.panelOptions);
    });

    it("it adds the missing panel options components to older (e.g FP2) config", () => {
        let formattedConfig = formatter.formatFrontendConfig({
            mriConfig: fp2Config,
            dmConfig: JSON.parse(JSON.stringify(cdwConfig)),
            lang: "en",
        });
        expect(formattedConfig.panelOptions);
    });

    it("qe formatter works correctly when language is passed", () => {

        let formattedConfig = qeFormatter.format({
            config: JSON.parse(JSON.stringify(cdwConfig)),
            options: CONFIG_FORMATTER_SETTINGS.REDUCED,
            lang: "de",
        });

        expect(formattedConfig.patient.attributes.smoker.name).toEqual("Raucher");
    });

    it("qe formatter works correctly when language is NOT passed", () => {

        let formattedConfig = qeFormatter.format({
            config: JSON.parse(JSON.stringify(cdwConfig)),
            options: CONFIG_FORMATTER_SETTINGS.REDUCED,
            lang: "",
        });

        expect(formattedConfig.patient.attributes.smoker.name).toEqual("Smoker");
    });

});
