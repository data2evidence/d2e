{
  "name": "alp-data-node",
  "version": "1.0.0",
  "description": "ALP Data Node",
  "license": "MIT",
  "config": {
    "env_names_all": "local remote base-all base-local base-remote alp-dev-sg-3 alp-dev-sg-2 alp-stg-de-1 alp-stg-sg-1 alp-stg-sg-2",
    "env_names_dev": "local remote base-all base-local base-remote alp-dev-sg-3"
  },
  "scripts": {
    "gen:dotenv": "scripts/gen-dotenv.sh && yarn gen:tls && yarn gen:resource-limits",
    "gen:tls": "scripts/gen-tls.sh",
    "gen:resource-limits": "scripts/gen-resource-limits.sh",

    "start:local:caddy": "yarn local:minerva up alp-caddy --force-recreate --wait",
    "start:remote:caddy": "yarn remote:minerva up alp-caddy --wait",
    "logs:caddy": "yarn base:minerva logs alp-caddy -t --until 1s",

    "base:minerva": "BASE_PORT=1 docker compose --file docker-compose.yml",
    "remote:minerva": "ENV_TYPE=remote yarn base:minerva --env-file .env.remote --profile minerva-ui --profile sql",
    "remote:minerva:perseus": "ENV_TYPE=remote yarn base:minerva --env-file .env.remote --profile minerva-ui --profile sql --profile perseus",
    "local:minerva": "ENV_TYPE=local yarn base:minerva --file docker-compose-local.yml ${ADDITIONAL_DC_FILES} --env-file .env.local --profile sql",

    "start:minerva": "yarn build:nest-prod:minerva && yarn local:minerva up --renew-anon-volumes",
    "start:minerva:perseus": "yarn local:minerva --profile perseus up --renew-anon-volumes",
    "start:nest-dev:minerva": "yarn build:nest-dev:minerva && ADDITIONAL_DC_FILES='--file docker-compose-nest-dev-local.yml' yarn local:minerva up --renew-anon-volumes alp-minerva-dataflow-mgmt alp-minerva-portal-server alp-minerva-terminology-svc --wait --force-recreate --no-deps",
    "start:nest-prod:minerva": "yarn build:nest-prod:minerva && yarn local:minerva up --renew-anon-volumes alp-minerva-dataflow-mgmt alp-minerva-portal-server alp-minerva-terminology-svc --wait --force-recreate --no-deps",

    "init:logto": "yarn local:minerva up alp-minerva-postgres alp-logto --wait && yarn local:minerva up alp-logto-post-init",
    
    "build:minerva": "yarn local:minerva build --build-arg GIT_COMMIT_ARG=$(git rev-parse HEAD)",
    "build:nest-dev:minerva": "ADDITIONAL_DC_FILES='--file docker-compose-nest-dev-local.yml' yarn build:minerva alp-minerva-dataflow-mgmt alp-minerva-portal-server alp-minerva-terminology-svc",
    "build:nest-prod:minerva": "yarn build:minerva alp-minerva-dataflow-mgmt alp-minerva-portal-server alp-minerva-terminology-svc",
    
    "stop:minerva": "yarn local:minerva stop",
    "clean:minerva": "yarn local:minerva down --volumes --remove-orphans",
    "config:minerva": "yarn local:minerva config",
    "ps:minerva": "yarn local:minerva ps",
    "logs:minerva": "yarn base:minerva logs -t --until 1s",

    "base:ui": "DN_REPO_RELATIVE_PATH='.' && GIT_HEAD_COMMIT_ALP_UI_REPO=$(git -C $UI_REPO_RELATIVE_PATH rev-parse HEAD) docker compose --file ${DN_REPO_RELATIVE_PATH}/docker-compose.yml --file ${DN_REPO_RELATIVE_PATH}/docker-compose-local.yml --profile minerva-s3",
    "az:start:ui": "yarn base:ui up alp-caddy",
    "start:ui": "UI_REPO_RELATIVE_PATH='../d2e-ui' yarn az:start:ui",
    "build:start:ui": "UI_REPO_RELATIVE_PATH='../d2e-ui' && yarn base:ui --file ${UI_REPO_RELATIVE_PATH}/docker-compose-ui.yml up alp-caddy",
    "build:ui": "UI_REPO_RELATIVE_PATH='../d2e-ui' && yarn base:ui --file ${UI_REPO_RELATIVE_PATH}/docker-compose-ui.yml build alp-caddy",

    "build:minerva-test": "yarn local:minerva build",
    "start:minerva-test": "yarn local:minerva start",

    "create-postgres-cdm-schemas": "bash scripts/create-cdm-schema.sh",
    "build": "ts-node internal/build/buildservices.ts build",
    "tsc": "ts-node internal/build/buildservices.ts build --only-tsc",
    "inittestdb": "node internal/build/initdb.js test",
    "removetestdb": "node internal/build/initdb.js rmonly",
    "start:data-load": "yarn local:minerva --profile data-load up --wait",
    "internal": "npm run-script --prefix internal"
  },
  "devDependencies": {
    "@types/node": "^18",
    "yarn": "1.22.10",
    "ts-node": "9.1.1"
  },
  "optionalDependencies": {
    "@alp/alp-dbcli": "file:cache/drivers/alp-dbcli-v1.0.0.tgz"
  },
  "private": true,
  "workspaces": {
    "packages": [
      "alp-libs/nodejs/*",
      "services/alp-db-svc",
      "services/analytics-svc",
      "services/query-gen-svc",
      "services/bookmark-svc",
      "services/envConverter",
      "services/mri-pg-config",
      "services/cdw-svc"
    ]}
}