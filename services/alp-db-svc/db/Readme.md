
## Useful Hana commands

CREATE DATABASE ALP SYSTEM USER PASSWORD <PASSWORD>;

CREATE USER HANA_TENANT_ADMIN_USER PASSWORD Toor1234 NO FORCE_FIRST_PASSWORD_CHANGE;

GRANT CREATE SCHEMA, DATA ADMIN, ROLE ADMIN, USER ADMIN, CATALOG READ, AUDIT ADMIN, IMPORT TO HANA_TENANT_ADMIN_USER;

CREATE RESTRICTED USER HANA_READ_USER PASSWORD Password123 NO FORCE_FIRST_PASSWORD_CHANGE;

ALTER USER HANA_READ_USER ENABLE CLIENT CONNECT;

CREATE ROLE HANA_READ_ROLE;

GRANT HANA_READ_ROLE TO HANA_READ_USER;

GRANT SELECT, EXECUTE ON SCHEMA my_schema TO HANA_READ_ROLE;

CREATE RESTRICTED USER HANA_WRITE_USER PASSWORD Password123 NO FORCE_FIRST_PASSWORD_CHANGE;

ALTER USER HANA_WRITE_USER ENABLE CLIENT CONNECT;

CREATE ROLE HANA_WRITE_ROLE;

GRANT HANA_WRITE_ROLE TO HANA_WRITE_USER;

GRANT DELETE, EXECUTE, INSERT, SELECT, UPDATE ON SCHEMA my_schema TO HANA_WRITE_ROLE;

SELECT * FROM "PUBLIC"."GRANTED_PRIVILEGES" where grantee = 'TENANT_WRITE_ROLE';

alter system alter configuration('global.ini','system') set ('public_hostname_resolution','map_hxehost')='20.218.247.116' with reconfigure;

drop user tenant_read_user cascade;

drop role tenant_read_role;

drop role tenant_write_role;

drop user tenant_write_user cascade;

drop schema cdms4h cascade;

## Setup Cockpit Technical User

CREATE USER COCKPIT_TECH_USER PASSWORD <PASSWORD> NO FORCE_FIRST_PASSWORD_CHANGE;

ALTER USER COCKPIT_TECH_USER DISABLE PASSWORD LIFETIME;

GRANT CATALOG READ TO COCKPIT_TECH_USER;

GRANT SELECT ON SCHEMA _SYS_STATISTICS TO COCKPIT_TECH_USER;

DROP USER COCKPIT_TECH_USER;

## Setup Encryption for Subsequent Tenant Databases
ALTER SYSTEM SET ENCRYPTION ROOT KEYS BACKUP PASSWORD <PASSWORD>;

#### Backup encryption root keys From tenant DB
SELECT ENCRYPTION_ROOT_KEYS_EXTRACT_KEYS ('PERSISTENCE, APPLICATION, BACKUP, LOG') FROM DUMMY;

### Activate root keys From Tenant DB
ALTER SYSTEM PERSISTENCE ENCRYPTION ACTIVATE NEW ROOT KEY;

ALTER SYSTEM LOG ENCRYPTION ACTIVATE NEW ROOT KEY;

ALTER SYSTEM BACKUP ENCRYPTION ACTIVATE NEW ROOT KEY;

ALTER SYSTEM APPLICATION ENCRYPTION ACTIVATE NEW ROOT KEY;

### Enable Encryption from Tenant DB
ALTER SYSTEM PERSISTENCE ENCRYPTION ON;

ALTER SYSTEM LOG ENCRYPTION ON;

ALTER SYSTEM BACKUP ENCRYPTION ON;

### Check State of encryption root keys from Tenant DB
SELECT * FROM ENCRYPTION_ROOT_KEYS;


## Backup & Recovery
--query status
select * from M_BACKUP_CATALOG;

select * from M_ENCRYPTION_OVERVIEW;

--backup Tenant DB complete data From Tenant DB / SystemDB from Systemdb
BACKUP DATA USING FILE ('TEST2') COMMENT 'test data backup after encryption enabled';

--backup Tenant DB difference from last backup From Tenant DB / SystemDB from Systemdb
BACKUP DATA INCREMENTAL USING FILE ('TEST2');

--Recover Tenant DB From System DB
ALTER SYSTEM STOP DATABASE ALP;

RECOVER DATABASE FOR ALP UNTIL TIMESTAMP '2020-11-16 22:00:00' CHECK ACCESS ALL;

ALTER SYSTEM START DATABASE ALP;

## System DB only

CREATE AUDIT POLICY "license creation" AUDITING ALL SET SYSTEM LICENSE LEVEL INFO;

CREATE AUDIT POLICY "license deletion" AUDITING ALL UNSET SYSTEM LICENSE LEVEL INFO;

ALTER AUDIT POLICY "license creation" ENABLE;

ALTER AUDIT POLICY "license deletion" ENABLE;

## System and Tenant DB

CREATE AUDIT POLICY "user administration" AUDITING ALL CREATE USER, ALTER USER, DROP USER LEVEL INFO;

ALTER AUDIT POLICY "user administration" ENABLE;

CREATE AUDIT POLICY "authorizations" AUDITING ALL GRANT ANY, REVOKE ANY LEVEL INFO;

ALTER AUDIT POLICY "authorizations" ENABLE;

CREATE AUDIT POLICY "recover database" AUDITING ALL RECOVER DATA LEVEL INFO;

ALTER AUDIT POLICY "recover database" ENABLE;

CREATE AUDIT POLICY "designtime privileges" AUDITING ALL
EXECUTE on _SYS_REPO.GRANT_ACTIVATED_ANALYTICAL_PRIVILEGE,
_SYS_REPO.GRANT_ACTIVATED_ROLE,
_SYS_REPO.GRANT_APPLICATION_PRIVILEGE,
_SYS_REPO.GRANT_PRIVILEGE_ON_ACTIVATED_CONTENT,
_SYS_REPO.GRANT_SCHEMA_PRIVILEGE_ON_ACTIVATED_CONTENT,
_SYS_REPO.REVOKE_ACTIVATED_ANALYTICAL_PRIVILEGE,
_SYS_REPO.REVOKE_ACTIVATED_ROLE,
_SYS_REPO.REVOKE_APPLICATION_PRIVILEGE,
_SYS_REPO.REVOKE_PRIVILEGE_ON_ACTIVATED_CONTENT,
_SYS_REPO.REVOKE_SCHEMA_PRIVILEGE_ON_ACTIVATED_CONTENT
LEVEL INFO;

ALTER AUDIT POLICY "designtime privileges" ENABLE;

## Delete old backups

BACKUP CATALOG DELETE ALL BEFORE BACKUP_ID 1605530723431 COMPLETE;

## Enable xs classic engine

ALTER SYSTEM ALTER configuration ('xsengine.ini','SYSTEM') SET ('httpserver','embedded')= 'true' WITH reconfigure;

ALTER SYSTEM ALTER configuration ('xsengine.ini','SYSTEM') SET ('httpserver','workerpoolsize')= '5' WITH reconfigure;

To enable the XS Job Scheduler, use the following SQL statement:

ALTER SYSTEM ALTER configuration ('xsengine.ini','SYSTEM') SET ('scheduler','enabled')= 'true' WITH reconfigure;

## Get Count of tables

SET SCHEMA <SCHEMA_NAME>;
select count (1) from "VIEW::GDM.CONSENT_BASE";
select count (1) from "VIEW::GDM.QUESTIONNAIRE_RESPONSE_BASE";
select count (1) from "VIEW::GDM.RESEARCH_SUBJECT_BASE";
select count (1) from "VIEW::OMOP.COND";
select count (1) from "VIEW::OMOP.COND_ERA";
select count (1) from "VIEW::OMOP.COND_ICD10";
select count (1) from "VIEW::OMOP.DEATH";
select count (1) from "VIEW::OMOP.DEVICE_EXPOSURE";
select count (1) from "VIEW::OMOP.DOSE_ERA";
select count (1) from "VIEW::OMOP.DRUG_ERA";
select count (1) from "VIEW::OMOP.DRUG_EXP";
select count (1) from "VIEW::OMOP.GDM.PATIENT";
select count (1) from "VIEW::OMOP.MEAS";
select count (1) from "VIEW::OMOP.OBS";
select count (1) from "VIEW::OMOP.OBS_PER";
select count (1) from "VIEW::OMOP.PATIENT";
select count (1) from "VIEW::OMOP.PP_PER";
select count (1) from "VIEW::OMOP.PROC";
select count (1) from "VIEW::OMOP.SPEC";
select count (1) from "VIEW::OMOP.VISIT";